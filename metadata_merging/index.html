<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Metadata merging - MEV REST API</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../style.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Metadata merging";
    var mkdocs_page_input_path = "metadata_merging.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> MEV REST API</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../general_architecture/">Architecture</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Installation and Setup</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../install/">Preliminaries</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mev_cluster_setup/">MEV cluster setup</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../setup_configuration/">Configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cromwell_setup/">Cromwell job runner setup</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../api/">Intro and core concepts</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Data Structures</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="#">Resources</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../resources/">General info</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../resource_types/">Resource types</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../resource_metadata/">Resource metadata</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../operation_resources/">Operation-associated resources</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../attributes/">Attributes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../elements/">Observations and Features</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../observation_and_feature_sets/">ObservationSet and FeatureSets</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../workspaces/">Workspaces</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../metadata/">Workspace metadata</a>
                </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../auth/">Authentication</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../operations/">Operation concepts</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../creating_analyses/">Creating new analyses/operations</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../example_workflow/">Workflow and analysis concepts</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">MEV REST API</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Metadata merging</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/web-mev/mev-backend/edit/master/docs/metadata_merging.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="merging-metadata"><a class="toclink" href="#merging-metadata">Merging metadata</a></h2>
<p>This document goes over some of the issues concerning the harmonization and merging of resource metadata, particularly when we plan to use that metadata as filters or inputs in the context of an analysis workspace.</p>
<h3 id="backgroundcontext"><a class="toclink" href="#backgroundcontext">Background/context</a></h3>
<p>Initially, we thought that each file/<code>Resource</code> should have metadata associated with it. This metadata includes:</p>
<ul>
<li>
<p><code>ObservationSet</code>: The set of samples or <code>Observations</code> that a file contains. For instance, given an expression matrix with $N$ columns, this would be the $N$ column names. For files where we have a 1:1 association with an <code>Observation</code> (e.g. a FastQ file), the <code>ObservationSet</code> contains only a single item. The <code>Observation</code> instances nested within the <code>ObservationSet</code> are used to hold additional data about each sample. That is, the expression matrix can have the <em>name</em> of the sample, but cannot tell us its phenotype, treatment group, etc. The <code>Observation</code> data structure allows us to associate a set of attributes.</p>
</li>
<li>
<p><code>FeatureSet</code>: Similar to above. Here, we imagined (again, using the example of an expression matrix) that each <code>Observation</code>/sample would have a number of <code>Feature</code>s associated with it. For example, an <code>Observation</code>/sample has $m$ genes. Similar to <code>Observation</code>s, our <code>Feature</code>s can carry additional information about the gene (such as its status as a putative oncogene, its mutation status, etc.)</p>
</li>
</ul>
<p>The whole idea of the metadata concept was to provide the user with the ability to filter their data during the analysis. For instance, one can say, "give me all <code>Observation</code>s/samples from the treated group" and we can iterate through the <code>ObservationSet</code> associated with their <code>Workspace</code> and return that subset.</p>
<p>Similarly, if we perform, say, a differential expression analysis, we can then ask for all the genes that passed significance at some threshold (e.g. 0.05). In our nomenclature, this amounts to saying, "give me all <code>Feature</code>s/genes where its <code>pvalue</code> attribute is less than 0.05"</p>
<h3 id="where-we-have-some-problems"><a class="toclink" href="#where-we-have-some-problems">Where we have some problems</a></h3>
<p>Regardless of the analysis, the <code>ObservationSet</code> within a <code>Workspace</code> is fairly static. We can imagine adding attributes to each <code>Observation</code>, but an analysis operation does not fundamentally change any thing about each <code>Observation</code>.</p>
<p>However, the situation is different for <code>Feature</code>s. Imagine running two different statistical tests for differential expression. The analyses produce similar tables.</p>
<p>From analysis A:</p>
<table>
<thead>
<tr>
<th>gene</th>
<th>logFoldChange</th>
<th>pval</th>
</tr>
</thead>
<tbody>
<tr>
<td>geneA</td>
<td>2.2</td>
<td>0.02</td>
</tr>
<tr>
<td>geneB</td>
<td>-0.2</td>
<td>0.05</td>
</tr>
</tbody>
</table>
<p>From analysis B:
| gene  | lfc | pval |
|-------|---------------|------|
| geneB | -0.03           | 0.1 |
| geneA | 2.03          | 0.00005 |</p>
<p>Above, both would have p-values representing the significance of differential expression. </p>
<p>Thus, depending on the context, the "attributes" of geneA or geneB would be different. There is no immediately sensible way to handle this in a general way.</p>
<h3 id="possible-fix"><a class="toclink" href="#possible-fix">Possible fix</a></h3>
<p>Recall that the primary reason for defining <code>FeatureSet</code>s and <code>ObservationSet</code>s is to provide a way to filter down to samples or genes of interest. We can use <code>ObservationSet</code>s to set up a contrast and we could use a <code>FeatureSet</code> to hold a set of genes that are important (e.g. because they are differentially expressed, or maybe because they are related to some biological function). </p>
<p>If we restrict the selection of <code>FeatureSet</code>s to the context of a single <code>Resource</code>, then we can avoid this issue of "conflicting" <code>Feature</code> attributes. One drawback is that the user is required to remember exactly how the <code>FeatureSet</code> was created. For instance, the set of selected genes may be different in analysis A and analysis B and the user should know the file from which they originated. For this reason, we should have a way for the user to name/label the <code>FeatureSet</code>s.</p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/web-mev/mev-backend/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
